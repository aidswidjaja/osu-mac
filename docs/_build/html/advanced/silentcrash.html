

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SilentCrash &mdash; osu!mac</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Other resources" href="../about/resources.html" />
    <link rel="prev" title="Advanced troubleshooting" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> osu!mac
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/choose.html">Which Wineskin should I get?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/silicon.html">Technocoder’s Wineskin with support for Apple Silicon under Rosetta 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/10-15.html">Technocoder’s Wineskin with support for macOS 10.15 Catalina and later</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/10-14.html">slc’s Wineskin for macOS 10.14 Mojave and earlier</a></li>
</ul>
<p class="caption"><span class="caption-text">Welcome to osu!</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../welcome/index.html">Welcome to osu!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../welcome/screen.html">Setting up your screen options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../welcome/import.html">Importing beatmaps and skins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../welcome/transfer.html">Transferring data from another osu! installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Common issues</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/troubleshooting.html">Troubleshooting Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/applesilicon-bigsur.html">Apple Silicon / Big Sur issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/dotnet.html">.NET runtime issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/commandprompt.html">Command prompt window showing before osu! crashes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/gdiplus-cjkfonts.html">osu! has graphical glitches, or isn’t rendering icons/CJK fonts properly</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/unidentified.html">osu! cannot be opened because the developer cannot be verified</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/monterey.html">osu! doesn’t run on macOS Monterey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/start.html">Startup issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/wineskin.html">Wineskin.app doesn’t open, even if osu! does / exec[number].bat problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/graphics.html">osu! was unable to obtain a graphics context</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/dualmonitor.html">osu! captures my monitor/my second monitor is black</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/retina.html">Enabling Retina Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/input.html">Mouse/trackpad input feels unstable</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/wontclose.html">osu! won’t close</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/malware.html">osu! is being detected as malware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/macos-agent.html">Pointing osu!macOS Agent to your osu! install location</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/agent-crash.html">osu!macOS Agent crashes on startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/discord-10-14.html">Discord Rich Presence (32-bit Wineskins / non-WS11 WineskinServer)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/discord-10-15.html">Discord Rich Presence (64-bit Wineskins / WS-11 WineskinServer)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/discord-disc.html">Discord Rich Presence (Discussion)</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced troubleshooting</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Advanced troubleshooting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">SilentCrash</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preliminary-analysis">Preliminary analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-on-apple-silicon">Running on Apple Silicon</a></li>
<li class="toctree-l2"><a class="reference internal" href="#regression-testing">Regression testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-with-lldb">Debugging with lldb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gdbidoof">gdbidoof</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#list-of-user-reports">List of user reports</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#related-to-silentcrash">Related to SilentCrash</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-user-issues">Other user issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#acknowledgements">Acknowledgements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#useful-resources">Useful resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">About osu!mac</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/resources.html">Other resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/templates.html">Support templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/license.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">osu!mac</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>SilentCrash</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/advanced/silentcrash.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="silentcrash">
<h1>SilentCrash<a class="headerlink" href="#silentcrash" title="Permalink to this headline">¶</a></h1>
<div class="wineskin-version line-block">
<div class="line">This article is applicable to the following wrappers:</div>
<div class="line">• <a class="reference external" href="https://osu.ppy.sh/users/10338558">Technocoder</a>’s <a class="reference external" href="https://osu.ppy.sh/community/forums/topics/1106057">Wineskin with macOS Catalina 10.15 support</a></div>
<div class="line">• <a class="reference external" href="https://osu.ppy.sh/users/10338558">Technocoder</a>’s <a class="reference external" href="https://osu.ppy.sh/community/forums/topics/682197">Wineskin with Apple Silicon support</a></div>
</div>
<p>SilentCrash is a user-reported issue with the osu! Wineskins that occured around July - September 2021, affecting both the Apple Silicon and x86 Wineskins on predominantly Apple Silicon devices on Big Sur, but also a small subset of x86 devices.</p>
<ul class="simple">
<li><p>Users would properly install the osu! wrapper</p></li>
<li><p>The game may update or even begin to load, but will immediately close without warning upon startup</p></li>
<li><p>WINE logs do not provide any obvious error messages</p></li>
<li><p>osu!macOS Agent reports are usually clean</p></li>
<li><p>Logs appear to be extremely similar to a normal executable run and closure</p></li>
</ul>
<div class="section" id="preliminary-analysis">
<h2>Preliminary analysis<a class="headerlink" href="#preliminary-analysis" title="Permalink to this headline">¶</a></h2>
<p>The first obvious step was to compare Wineskin Test Run logs in the hope they’d be useful to give away any obvious error. Using the <a class="reference external" href="http://meldmerge.org/">Meld</a> diff viewer showed that there were no useful differences between a standard run executed on my system, and user-received reports.</p>
<img alt="Meld window comparing test run log files" src="../_images/meld.png" />
<p>In past times we had another bug with .NET that was easily identifiable within Test Run logs, and indicative of a race condition related to low-level runtime issues (i.e garbage collection, binary translation) but could be fixed usually through updating the dotnet Winetrick. The SilentCrash issue represents the first emergence of a similarly symptomatic error, but it is likely different, if not unrelated.</p>
</div>
<div class="section" id="running-on-apple-silicon">
<h2>Running on Apple Silicon<a class="headerlink" href="#running-on-apple-silicon" title="Permalink to this headline">¶</a></h2>
<p>I was unable to reproduce the user reports on my Intel 80386 based Mac, so I borrowed a family member’s 2020 MacBook Air with M1. I could not reproduce the error and osu! ran successfully.</p>
</div>
<div class="section" id="regression-testing">
<h2>Regression testing<a class="headerlink" href="#regression-testing" title="Permalink to this headline">¶</a></h2>
<p>Considering this issue popped up with the first confirmed user report on 11 July 2021, it could have possibly been a regression within the osu! executable. The Wineskin was last updated on 15 February 2021, and the issue is persistent across both Apple Silicon and i386 Wineskins. Looking through the osu! changelogs from around this time, there is a particularly interesting <a class="reference external" href="https://osu.ppy.sh/home/changelog/stable40/20210519.3">changelog update</a> dated 19 May 2021.</p>
<blockquote>
<div><p><a href="#id2"><span class="problematic" id="id3">|</span></a><strong>Improve reliability of beatmap detail fetches</strong>
<a href="#id4"><span class="problematic" id="id5">|</span></a>Fixes a startup race condition that could randomly cause beatmaps to get stuck in an “unknown” status rather than fetching their online details successfully. Any beatmaps already in this state will automatically check for new details each startup.</p>
</div></blockquote>
<p>We don’t have access to the source for stable, and we don’t know how this logic was implemented. Searching the osu!dev Discord server brought about limited results too.</p>
<p>In any case however, the osu! executable is an entirely valid PE32 executable. If a change in the program’s logic is in fact causing a crash, the fix is incumbent on us and not on osu!. Regardless of whether or not a regression was included in the osu! execuable, this calls for further analysis through debugging.</p>
<p>However, WineHQ AppDB [bug 50111](<a class="reference external" href="https://bugs.winehq.org/show_bug.cgi?id=50111">https://bugs.winehq.org/show_bug.cgi?id=50111</a>) does in fact show a regression introduced with the osu! executable as I had initially suspected. However, this regression was dated with osu-stable 20201110 and produced a Wine Mono error. Furthermore, notably osu! produces a crash error, which does not exist on our own user reports. Only <a class="reference external" href="https://osu.ppy.sh/community/forums/posts/8221806">user report #2</a> mimics this behaviour.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">0204</span>:fixme:wmiutils:status_code_GetErrorCodeText 103EB910, 0x80041002, 0x0000, 0x00000001, 0C74F374
</pre></div>
</div>
<p>User reports have mostly died down for now. Updating dotnet, which is the recommended resolution in 50111 (and the previously offered resolution), should continue to be recommended to users.</p>
</div>
<div class="section" id="debugging-with-lldb">
<h2>Debugging with lldb<a class="headerlink" href="#debugging-with-lldb" title="Permalink to this headline">¶</a></h2>
<p>In future, we should consider debugging to analyse the source issues (e.g regressions introduced into the executable such as this one). The main challenges are packaging this process in a user-friendly format, and being able to interpret the debugging on a Mono application for which we do not have source.</p>
<p>Although I was originally going to use winedbg and gdb, both are incompatible for different reasons.</p>
<ul class="simple">
<li><p><strong>winedbg</strong> does not run with wine32on64</p></li>
<li><p><strong>gdb</strong> requires a painful code-signing procedure to run on modern macOS</p></li>
</ul>
<p>Technocoder suggested to me that I use <strong>lldb</strong> to debug osu! - so using LLDB I want to generate a healthy startup stack trace.</p>
<p>Most user reports detail a successful update sequence and osu! logo followed by an immediate crash on startup.</p>
<div class="section" id="gdbidoof">
<h3>gdbidoof<a class="headerlink" href="#gdbidoof" title="Permalink to this headline">¶</a></h3>
<p>To overcome this, I am working on a small general-purpose debugging utility called gdbidoof. This would be used by end users to run a stack trace just before a crash, using the obscurely documented <code class="docutils literal notranslate"><span class="pre">--batch</span></code> mode brought to life by this <a class="reference external" href="https://stackoverflow.com/a/36580453/6299634">Stack Overflow comment by John</a>.</p>
<p>gdbidoof performs an end user-friendly version of the comment above with added features. Given that multiple processes are used by WINE, we’ll instead ask the user to use a (0d) PID on Wineserver and all preloader processers. Failing or otherwise, we’ll run backtraces on all threads (or the most recent core dump). This will help us narrow down what sort of instructions are being executed at a time of a crash (particularly a silent crash with no obvious errors).</p>
<p>This program is currently under development.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Requires lldb-340.4.119 (Xcode 7.2) or greater</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-b
--batch
        Tells the debugger to running the commands from -s, -S, -o <span class="p">&amp;</span> -O,
        and <span class="k">then</span> quit.  However <span class="k">if</span> any run <span class="nb">command</span> stopped due to a signal
        or crash, the debugger will <span class="k">return</span> to the interactive prompt at the
        place of the crash.

-o
--one-line
        Tells the debugger to execute this one-line lldb <span class="nb">command</span> after any
        file provided on the <span class="nb">command</span> line has been loaded.

-k
--one-line-on-crash
        When in batch mode, tells the debugger to execute this one-line
        lldb <span class="nb">command</span> <span class="k">if</span> the target crashes.
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="list-of-user-reports">
<h2>List of user reports<a class="headerlink" href="#list-of-user-reports" title="Permalink to this headline">¶</a></h2>
<div class="section" id="related-to-silentcrash">
<h3>Related to SilentCrash<a class="headerlink" href="#related-to-silentcrash" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://osu.ppy.sh/community/forums/posts/8191421">User report #1</a></p></li>
<li><p><a class="reference external" href="https://osu.ppy.sh/community/forums/posts/8221806">User report #2</a></p></li>
<li><p><a class="reference external" href="https://osu.ppy.sh/community/forums/posts/8247767">User report #3</a> (may be unrelated)</p></li>
</ul>
</div>
<div class="section" id="other-user-issues">
<h3>Other user issues<a class="headerlink" href="#other-user-issues" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://osu.ppy.sh/community/forums/posts/8162613">User report A</a></p></li>
<li><p><a class="reference external" href="https://osu.ppy.sh/community/forums/posts/8168700">User report B</a> (possibly related; no test run to confirm)</p></li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Thanks to <a class="reference external" href="https://osu.ppy.sh/users/10338558">Technocoder</a> for useful information about debugging with LLDB</p></li>
<li><p>Thanks to <a class="reference external" href="https://github.com/Gcenx/">Gcenx</a> for useful information about winedbg</p></li>
<li><p>Thanks to <a class="reference external" href="https://bugs.winehq.org/show_bug.cgi?id=50111">aidas956</a> for their bug report on WineHQ Bugzilla</p></li>
</ul>
<div class="section" id="useful-resources">
<h3>Useful resources<a class="headerlink" href="#useful-resources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://wiki.winehq.org/Wine_Developer%27s_Guide/Debugging_Wine">Wine Developer’s Guide/Debugging Wine</a></p></li>
<li><p><a class="reference external" href="https://wiki.winehq.org/Debugging_Hints">Debugging Hints</a></p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../about/resources.html" class="btn btn-neutral float-right" title="Other resources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Advanced troubleshooting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright aidswidjaja and other osu!mac contributors. Licensed under the FreeBSD Documentation License, available at https://www.freebsd.org/copyright/freebsd-doc-license.html

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. <jinja2.runtime.BlockReference object at 0x106da3880>
<br><br>
<div class="customfooter">
    <strong>
        <p>Visit more <a href="https://osu-mac.readthedocs.io/en/latest/about/resources.html">community resources</a> to help you get osu! running on macOS.</p>
        <p>View our <a href="https://osu-mac.readthedocs.io/en/latest/issues/index.html">Issues</a> section for tips on how to <a href="https://osu-mac.readthedocs.io/en/latest/issues/troubleshooting.html">troubleshoot</a> your problems, or see how to diagnose common issues other users have experienced in the past.</p>
        <p>Make these docs better by <a href="https://osu-mac.readthedocs.io/en/latest/about/contributing.html">contributing to osu!mac</a> on <a href="https://github.com/aidswidjaja/osu-mac">GitHub</a>.
        <p>Visit the <a href="https://osu.ppy.sh/community/forums/5">osu! forums</a> if you're stuck with anything at all!
        </p>
    </strong>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>